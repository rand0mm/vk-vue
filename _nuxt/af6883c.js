(window.webpackJsonp=window.webpackJsonp||[]).push([[5,2,3,4],{306:function(e,t,r){"use strict";var n=r(2),o=r(87).find,c=r(138),l="find",d=!0;l in[]&&Array(1).find((function(){d=!1})),n({target:"Array",proto:!0,forced:d},{find:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),c(l)},307:function(e,t,r){"use strict";r.r(t);r(28);var n=r(13),o=(r(66),r(45),r(85),r(86),r(14),r(36),r(212),r(306),{data:function(){return{searchStr:"",delay:null,foundUsers:[],isSomeAxiosError:!1,isShowFoundData:!1,tokenVK:"vk1.a.Iu-BtXMlHKvmNtwrKbm6cMxzNDHuHKn8Gs_1jo1a9Ngobwc50e2iG-8IygsFbXz2MK_clnwDtao0Tuv0qCg572Fpua4k-iJfKmA4ChxGrua78DKtX6RmFHM-3jYn2yDc_HMGGGbM1AuYBVgc-GceVff0rDekFXsKY2Pamw2ciVQHxZkqeeudFuBZLA7h7X-4-FTSm4WgiLf-KN15KCLAfQ"}},computed:{isShowFound:function(){return!!this.isShowFoundData&&this.users.length>0},selectedUSers:function(){return this.$store.getters["users/selectedUSers"]},users:function(){return this.foundUsers?this.foundUsers.map((function(i){return{id:i.id,name:"".concat(i.first_name," ").concat(i.last_name),photo:i.photo_100,bdate:i.bdate,sex:{id:i.sex,title:2===i.sex?"Мужской":"Женский"},access:i.can_access_closed}})):[]},friends:function(){return this.$store.getters["users/friends"]},maxCross:function(){return this.$store.getters["users/maxCross"]}},watch:{searchStr:function(){var e=this;this.delay=clearTimeout(this.delay),this.delay=setTimeout(Object(n.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.searchStr,e.foundUsers=[],r.length>2&&r.length<=256&&(e.searchByStr(r,e.tokenVK),e.searchById(r,e.tokenVK));case 3:case"end":return t.stop()}}),t)}))),600)}},beforeMount:function(){var e=this;window.addEventListener("click",(function(t){t.target.closest(".add")||(e.isShowFoundData=!1)}))},methods:{searchByStr:function(e,t){var r=this;return Object(n.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,r.$jsonp("https://api.vk.com/method/users.search",{q:JSON.stringify(e),fields:"photo_100,bdate,sex",access_token:t,v:"5.131"});case 3:if(!(o=n.sent).error){n.next=7;break}throw r.isSomeAxiosError=!0,o.error.error_msg;case 7:o.response.items.length&&!r.isSomeAxiosError&&(r.foundUsers=r.foundUsers.concat(o.response.items)),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(0),r.foundUsers=[{first_name:"Ошибка при запросе",last_name:n.t0.message||n.t0}];case 13:case"end":return n.stop()}}),n,null,[[0,10]])})))()},searchById:function(e,t){var r=this;return Object(n.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,r.$jsonp("https://api.vk.com/method/users.get",{user_ids:e,fields:"photo_100,bdate,sex",access_token:t,v:"5.131"});case 3:if(!(o=n.sent).error){n.next=7;break}throw r.isSomeAxiosError=!0,o.error.error_msg;case 7:o.response.length&&!r.isSomeAxiosError&&o.response.forEach((function(e){r.foundUsers.unshift(e)})),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(0),r.foundUsers=[{first_name:"Ошибка при запросе",last_name:n.t0.message||n.t0}];case 13:case"end":return n.stop()}}),n,null,[[0,10]])})))()},getFriends:function(e,t){var r=this;return Object(n.a)(regeneratorRuntime.mark((function n(){var o,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,r.$jsonp("https://api.vk.com/method/friends.get",{user_id:e.id,access_token:t,fields:"photo_100,bdate,sex",v:"5.131"});case 3:if(!(o=n.sent).error){n.next=6;break}throw o.error.error_msg;case 6:return c=JSON.parse(JSON.stringify(r.friends)),o.response.items.map((function(i){if(c[i.id]){c[i.id].cross?c[i.id].cross.push(e.id):c[i.id].cross=[e.id];var t=c[i.id].cross.length;r.maxCross<t&&(r.$store.commit("users/setMaxCross",t),localStorage.setItem("cross",JSON.stringify(t)))}else{var n=i;n.cross=[e.id],"DELETED"!==i.first_name&&(c[i.id]=n)}return i})),r.$store.commit("users/setFriends",c),localStorage.setItem("friends",JSON.stringify(c)),console.log("обновленный список всех друзей",Object.values(r.friends).length),n.abrupt("return",o.response.count);case 14:return n.prev=14,n.t0=n.catch(0),console.log("Ошибка запроса:".concat(n.t0.message||n.t0)),n.abrupt("return","error");case 18:case"end":return n.stop()}}),n,null,[[0,14]])})))()},choiceUser:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var n,o,c,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=t.tokenVK,o=e,c=JSON.parse(JSON.stringify(t.selectedUSers)),t.isShowFoundData=!1,console.log("Выбранный пользователь",e),c.find((function(i){return i.id===e.id}))){r.next=14;break}if(!e.access){r.next=11;break}return r.next=9,t.getFriends(e,n);case 9:l=r.sent,o.friendsCount=l;case 11:c.push(o),t.$store.commit("users/setSelectedUSers",c),localStorage.setItem("users",JSON.stringify(c));case 14:console.log("массив после добавления",t.selectedUSers);case 15:case"end":return r.stop()}}),r)})))()}}}),c=r(53),component=Object(c.a)(o,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"content__add add"},[t("label",{staticClass:"add__label",attrs:{for:"users"}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchStr,expression:"searchStr"}],staticClass:"add__input",attrs:{type:"text",name:"users",placeholder:"Введите индентификатор или имя пользователя",autocomplete:"off"},domProps:{value:e.searchStr},on:{focus:function(t){t.preventDefault(),e.isShowFoundData=!0},input:function(t){t.target.composing||(e.searchStr=t.target.value)}}})]),e._v(" "),e.isShowFound?t("perfect-scrollbar",{staticClass:"users add__users",class:{add_error:e.isSomeAxiosError}},[t("ul",{staticClass:"users__list"},e._l(e.users,(function(r){return t("li",{key:"foundUser-"+r.id,staticClass:"users__item",on:{click:function(t){return t.preventDefault(),e.choiceUser(r)}}},[e.isSomeAxiosError?e._e():t("span",{staticClass:"users__photo"},[t("img",{staticClass:"users__img",attrs:{src:r.photo,alt:"фото"+r.name}})]),e._v(" "),t("span",{staticClass:"users__name"},[e._v(e._s(r.name)+" ")])])})),0)]):e._e()],1)}),[],!1,null,null,null);t.default=component.exports},308:function(e,t,r){"use strict";r.r(t);r(28),r(213),r(306),r(14),r(37);var n={data:function(){return{}},computed:{isShowUsers:function(){return this.selectedUSers.length>0},selectedUSers:function(){var e=this.$store.getters["users/selectedUSers"];return e.sort((function(a,b){return a.name>b.name?1:-1})),e}},watch:{},methods:{removeUser:function(e){var t=JSON.parse(JSON.stringify(this.selectedUSers));t.find((function(i){return i.id===e.id}))&&(t=t.filter((function(i){return i.id!==e.id})),this.$store.commit("users/setSelectedUSers",t),localStorage.setItem("users",JSON.stringify(t)),this.$store.dispatch("users/syncFriendList"))},showFriendList:function(){this.$store.dispatch("users/syncFriendList"),this.$store.commit("users/setIsShowFriends",!0),localStorage.setItem("showFriends",JSON.stringify(!0)),this.$store.dispatch("users/loadFriendsInfo")}}},o=r(53),component=Object(o.a)(n,(function(){var e=this,t=e._self._c;return e.isShowUsers?t("div",{staticClass:"users"},[t("h2",{staticClass:"content__title"},[e._v("\n    Выбранные пользователи:\n  ")]),e._v(" "),e.isShowUsers?t("ul",{staticClass:"users__list"},e._l(e.selectedUSers,(function(r){return t("li",{key:"foundUser-"+r.id,staticClass:"users__item"},[t("span",{staticClass:"users__photo"},[t("img",{staticClass:"users__img",attrs:{src:r.photo,alt:"фото"+r.name}})]),e._v(" "),t("span",{staticClass:"users__info"},[t("span",{staticClass:"users__name"},[e._v("\n          "+e._s(r.name)+"\n        ")]),e._v(" "),t("span",{staticClass:"users__sex"},[e._v("Пол: "+e._s(r.sex.title)+" ")]),e._v(" "),t("span",{staticClass:"users__age"},[e._v("Возвраст: "+e._s(r.age)+" ")]),e._v(" "),t("span",{staticClass:"users__friends",class:{users__friends_error:!r.access}},[e._v("Друзей: "+e._s(r.friendsCount)+"\n        ")])]),e._v(" "),t("span",{staticClass:"users__remove btn",on:{click:function(t){return t.preventDefault(),e.removeUser(r)}}},[e._v("\n        Удалить\n      ")])])})),0):e._e(),e._v(" "),t("button",{staticClass:"btn build-btn",on:{click:function(t){return t.preventDefault(),e.showFriendList.apply(null,arguments)}}},[e._v("\n    Построить\n  ")])]):e._e()}),[],!1,null,null,null);t.default=component.exports},309:function(e,t,r){"use strict";r.r(t);r(28);var n=r(13),o=(r(66),r(212),r(213),r(45),r(85),r(215),r(86),r(46),r(14),r(29),r(30),r(36),r(214),{data:function(){return{delay:null,isLoading:0,test:0,refreshKey:0,tokenVK:"vk1.a.Iu-BtXMlHKvmNtwrKbm6cMxzNDHuHKn8Gs_1jo1a9Ngobwc50e2iG-8IygsFbXz2MK_clnwDtao0Tuv0qCg572Fpua4k-iJfKmA4ChxGrua78DKtX6RmFHM-3jYn2yDc_HMGGGbM1AuYBVgc-GceVff0rDekFXsKY2Pamw2ciVQHxZkqeeudFuBZLA7h7X-4-FTSm4WgiLf-KN15KCLAfQ"}},computed:{friends:function(){var e=this;console.log(this.refreshKey);var t=Object.values(this.$store.getters["users/friends"]);return t?t.map((function(i){var t=0;return i.cross&&(t=e.maxCross?Math.ceil(100*(i.cross.length||0)/e.maxCross):100),{id:i.id,name:"".concat(i.first_name," ").concat(i.last_name),photo:i.photo_100,cross:{percent:t,items:i.cross||[]},sex:2===i.sex?"Мужской":"Женский",age:e.getAge(i.bdate),friendsCount:i.friendsCount}})).sort((function(a,b){return a.name>b.name?1:-1})):[]},isShowUsers:function(){return this.$store.getters["users/isShowFriends"]},maxCross:function(){return this.$store.getters["users/maxCross"]},toLoadFriendData:function(){return this.$store.getters["users/toLoadFriendData"]}},watch:{toLoadFriendData:function(){0===this.isLoading&&this.loadFriend()}},mounted:function(){this.isShowUsers&&this.loadFriend()},methods:{goToProfile:function(e){this.$router.push({path:"/vk-vue/user/".concat(e)})},getAge:function(e){if(!e)return"?";var t=new Date,r=e.split(".");if(!r[2]||!r[1]||!r[0])return"?";var n=new Date(r[2],Number(r[1])-1,r[0]),o=t.getFullYear()-n.getFullYear(),c=t.getMonth()-n.getMonth();return(c<0||0===c&&t.getDate()<n.getDate())&&(o-=1),o},loadFriend:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,o,c,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.toLoadFriendData.length<1)){t.next=2;break}return t.abrupt("return");case 2:if(r=e.$route.name,o=!1,e.isLoading=1,clearTimeout(e.delay),e.delay=setTimeout(Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.isLoading=0;case 1:case"end":return t.stop()}}),t)}))),1e3),"vk-vue"!==r){t.next=23;break}return c=JSON.parse(JSON.stringify(e.toLoadFriendData)),l=c.slice(0,3),t.next=12,Promise.all(l.map((function(i){return e.resFriend(i.id)})));case 12:if(t.sent.forEach((function(i){i?e.$store.commit("users/setFriendInfo",{id:i.id,value:i.count}):o=!0})),o||(c.splice(0,3),e.refreshKey+=1,e.$store.commit("users/setToLoadFriendData",c),localStorage.setItem("toLoadFriendData",JSON.stringify(c))),1!==e.isLoading){t.next=22;break}return t.next=18,new Promise((function(e){return setTimeout(e,1200)}));case 18:t.sent,e.loadFriend(),t.next=23;break;case 22:0===e.isLoading&&e.loadFriend();case 23:case"end":return t.stop()}}),t)})))()},resFriend:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.$jsonp("https://api.vk.com/method/users.get",{user_id:e,access_token:t.tokenVK,fields:"counters",v:"5.131"});case 3:if(!(n=r.sent).error){r.next=7;break}throw console.log(n.error.error_msg),n.error.error_msg;case 7:return r.abrupt("return",{id:e,count:n.response[0].counters?n.response[0].counters.friends:"?"});case 10:return r.prev=10,r.t0=r.catch(0),console.log("Ошибка при запросе resFriend",r.t0.message||r.t0),r.abrupt("return",null);case 14:case"end":return r.stop()}}),r,null,[[0,10]])})))()}}}),c=r(53),component=Object(c.a)(o,(function(){var e=this,t=e._self._c;return e.isShowUsers?t("div",{staticClass:"users"},[t("h2",{staticClass:"content__title"},[e._v("\n    Друзья пользователей:\n  ")]),e._v(" "),t("perfect-scrollbar",{staticClass:"users__wrapper"},[t("ul",{staticClass:"users__list users__list_friends"},e._l(e.friends,(function(r){return t("li",{key:"foundUser-"+r.id,staticClass:"users__item",style:{backgroundColor:"rgba(0, 119, 255, ".concat((r.cross.percent||20)/100,")")},on:{click:function(t){return t.preventDefault(),e.goToProfile(r.id)}}},[t("span",{staticClass:"users__photo"},[t("img",{staticClass:"users__img",attrs:{src:r.photo,alt:"фото"+r.name}})]),e._v(" "),t("span",{staticClass:"users__info"},[t("span",{staticClass:"users__name"},[e._v("\n            "+e._s(r.name)+"\n          ")]),e._v(" "),t("span",{staticClass:"users__sex"},[e._v("Пол: "+e._s(r.sex)+" ")]),e._v(" "),t("span",{staticClass:"users__age"},[e._v("Возвраст: "+e._s(r.age)+" ")]),e._v(" "),t("span",{staticClass:"users__friends",class:{users__friends_error:!r.access}},[e._v("Друзей: "+e._s(r.friendsCount||"Загрузка...")+"\n          ")])])])})),0)])],1):e._e()}),[],!1,null,null,null);t.default=component.exports},310:function(e,t,r){"use strict";r.r(t);var n={data:function(){return{isShowUsersFriends:!1}},computed:{},watch:{}},o=r(53),component=Object(o.a)(n,(function(){var e=this,t=e._self._c;return t("main",{staticClass:"content container"},[t("h1",{staticClass:"content__title"},[e._v("\n    Панель управления списком пользователей\n  ")]),e._v(" "),t("SearchInput"),e._v(" "),t("SelectedUsers"),e._v(" "),t("UsersFriends")],1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{SearchInput:r(307).default,SelectedUsers:r(308).default,UsersFriends:r(309).default})}}]);