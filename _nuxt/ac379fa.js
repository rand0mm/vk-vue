(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{306:function(e,r,t){"use strict";var n=t(2),o=t(87).find,c=t(138),d="find",f=!0;d in[]&&Array(1).find((function(){f=!1})),n({target:"Array",proto:!0,forced:f},{find:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),c(d)},307:function(e,r,t){"use strict";t.r(r);t(28);var n=t(13),o=(t(66),t(45),t(85),t(86),t(14),t(36),t(212),t(306),{data:function(){return{searchStr:"",delay:null,foundUsers:[],isSomeAxiosError:!1,isShowFoundData:!1,tokenVK:"vk1.a.Iu-BtXMlHKvmNtwrKbm6cMxzNDHuHKn8Gs_1jo1a9Ngobwc50e2iG-8IygsFbXz2MK_clnwDtao0Tuv0qCg572Fpua4k-iJfKmA4ChxGrua78DKtX6RmFHM-3jYn2yDc_HMGGGbM1AuYBVgc-GceVff0rDekFXsKY2Pamw2ciVQHxZkqeeudFuBZLA7h7X-4-FTSm4WgiLf-KN15KCLAfQ"}},computed:{isShowFound:function(){return!!this.isShowFoundData&&this.users.length>0},selectedUSers:function(){return this.$store.getters["users/selectedUSers"]},users:function(){return this.foundUsers?this.foundUsers.map((function(i){return{id:i.id,name:"".concat(i.first_name," ").concat(i.last_name),photo:i.photo_100,bdate:i.bdate,sex:{id:i.sex,title:2===i.sex?"Мужской":"Женский"},access:i.can_access_closed}})):[]},friends:function(){return this.$store.getters["users/friends"]},maxCross:function(){return this.$store.getters["users/maxCross"]}},watch:{searchStr:function(){var e=this;this.delay=clearTimeout(this.delay),this.delay=setTimeout(Object(n.a)(regeneratorRuntime.mark((function r(){var t;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t=e.searchStr,e.foundUsers=[],t.length>2&&t.length<=256&&(e.searchByStr(t,e.tokenVK),e.searchById(t,e.tokenVK));case 3:case"end":return r.stop()}}),r)}))),600)}},beforeMount:function(){var e=this;window.addEventListener("click",(function(r){r.target.closest(".add")||(e.isShowFoundData=!1)}))},methods:{searchByStr:function(e,r){var t=this;return Object(n.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t.$jsonp("https://api.vk.com/method/users.search",{q:JSON.stringify(e),fields:"photo_100,bdate,sex",access_token:r,v:"5.131"});case 3:if(!(o=n.sent).error){n.next=7;break}throw t.isSomeAxiosError=!0,o.error.error_msg;case 7:o.response.items.length&&!t.isSomeAxiosError&&(t.foundUsers=t.foundUsers.concat(o.response.items)),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(0),t.foundUsers=[{first_name:"Ошибка при запросе",last_name:n.t0.message||n.t0}];case 13:case"end":return n.stop()}}),n,null,[[0,10]])})))()},searchById:function(e,r){var t=this;return Object(n.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t.$jsonp("https://api.vk.com/method/users.get",{user_ids:e,fields:"photo_100,bdate,sex",access_token:r,v:"5.131"});case 3:if(!(o=n.sent).error){n.next=7;break}throw t.isSomeAxiosError=!0,o.error.error_msg;case 7:o.response.length&&!t.isSomeAxiosError&&o.response.forEach((function(e){t.foundUsers.unshift(e)})),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(0),t.foundUsers=[{first_name:"Ошибка при запросе",last_name:n.t0.message||n.t0}];case 13:case"end":return n.stop()}}),n,null,[[0,10]])})))()},getFriends:function(e,r){var t=this;return Object(n.a)(regeneratorRuntime.mark((function n(){var o,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t.$jsonp("https://api.vk.com/method/friends.get",{user_id:e.id,access_token:r,fields:"photo_100,bdate,sex",v:"5.131"});case 3:if(!(o=n.sent).error){n.next=6;break}throw o.error.error_msg;case 6:return c=JSON.parse(JSON.stringify(t.friends)),o.response.items.map((function(i){if(c[i.id]){c[i.id].cross?c[i.id].cross.push(e.id):c[i.id].cross=[e.id];var r=c[i.id].cross.length;t.maxCross<r&&(t.$store.commit("users/setMaxCross",r),localStorage.setItem("cross",JSON.stringify(r)))}else{var n=i;n.cross=[e.id],"DELETED"!==i.first_name&&(c[i.id]=n)}return i})),t.$store.commit("users/setFriends",c),localStorage.setItem("friends",JSON.stringify(c)),console.log("обновленный список всех друзей",Object.values(t.friends).length),n.abrupt("return",o.response.count);case 14:return n.prev=14,n.t0=n.catch(0),console.log("Ошибка запроса:".concat(n.t0.message||n.t0)),n.abrupt("return","error");case 18:case"end":return n.stop()}}),n,null,[[0,14]])})))()},choiceUser:function(e){var r=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var n,o,c,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r.tokenVK,o=e,c=JSON.parse(JSON.stringify(r.selectedUSers)),r.isShowFoundData=!1,console.log("Выбранный пользователь",e),c.find((function(i){return i.id===e.id}))){t.next=14;break}if(!e.access){t.next=11;break}return t.next=9,r.getFriends(e,n);case 9:d=t.sent,o.friendsCount=d;case 11:c.push(o),r.$store.commit("users/setSelectedUSers",c),localStorage.setItem("users",JSON.stringify(c));case 14:console.log("массив после добавления",r.selectedUSers);case 15:case"end":return t.stop()}}),t)})))()}}}),c=t(53),component=Object(c.a)(o,(function(){var e=this,r=e._self._c;return r("div",{staticClass:"content__add add"},[r("label",{staticClass:"add__label",attrs:{for:"users"}},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.searchStr,expression:"searchStr"}],staticClass:"add__input",attrs:{type:"text",name:"users",placeholder:"Введите индентификатор или имя пользователя",autocomplete:"off"},domProps:{value:e.searchStr},on:{focus:function(r){r.preventDefault(),e.isShowFoundData=!0},input:function(r){r.target.composing||(e.searchStr=r.target.value)}}})]),e._v(" "),e.isShowFound?r("perfect-scrollbar",{staticClass:"users add__users",class:{add_error:e.isSomeAxiosError}},[r("ul",{staticClass:"users__list"},e._l(e.users,(function(t){return r("li",{key:"foundUser-"+t.id,staticClass:"users__item",on:{click:function(r){return r.preventDefault(),e.choiceUser(t)}}},[e.isSomeAxiosError?e._e():r("span",{staticClass:"users__photo"},[r("img",{staticClass:"users__img",attrs:{src:t.photo,alt:"фото"+t.name}})]),e._v(" "),r("span",{staticClass:"users__name"},[e._v(e._s(t.name)+" ")])])})),0)]):e._e()],1)}),[],!1,null,null,null);r.default=component.exports}}]);